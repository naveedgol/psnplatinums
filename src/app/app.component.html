<div class="totalPage">
  <mat-card class="options">
    <mat-card-content>
      <div class="search-box">
        <section class="section">
          <mat-form-field>
            <input matInput #searchInput placeholder="Enter a PSN ID" autocomplete="off"
              (keydown.enter)="search(searchInput.value)">
          </mat-form-field>
          <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>
          <div>Ensure your profile is up to date on
            <a target="_blank" href="https://psnprofiles.com/">PSNProfiles</a>.
          </div>
          <div class="error" *ngIf="error">
            User does not exist. Try adding your profile to
            <a target="_blank" [href]="'https://psnprofiles.com/' + this.userId">PSNProfiles</a>.
          </div>
          <div class="error" *ngIf="adblockError">
            An error occured. Try disabling your adblock.
          </div>
          <div class="error" *ngIf="throttleError">
            An error occured. The server is overloaded. Try again in an hour.
          </div>
        </section>
        <ng-container *ngIf="user">
          <mat-divider></mat-divider>
          <section class="section">
            <h2>Icon Type</h2>
            <mat-radio-group class="radioGroup" aria-label="Icon Type" [(ngModel)]="displaySettings.iconType">
              <mat-radio-button class="radioButton" value="TROPHY">Trophy</mat-radio-button>
              <mat-radio-button class="radioButton" value="GAME">Game</mat-radio-button>
            </mat-radio-group>
          </section>

          <mat-divider></mat-divider>
          <section class="section">
            <h2>Icon Size</h2>
            <mat-slider class="slider" thumbLabel min="10" max="200" step="1" value="56"
              [(ngModel)]="displaySettings.iconWidthPx">
            </mat-slider>
          </section>

          <mat-divider></mat-divider>
          <section class="section">
            <h2>Sort order</h2>
            <mat-radio-group class="radioGroup" aria-label="Sort Order" [(ngModel)]="sortOrder"
              (change)="applyFilters()">
              <mat-radio-button class="radioButton" value="date">Date</mat-radio-button>
              <mat-radio-button class="radioButton" value="rarity">Rarity</mat-radio-button>
              <mat-radio-button class="radioButton" value="alpha">Alphabetical (Game)</mat-radio-button>
            </mat-radio-group>
          </section>

          <mat-divider></mat-divider>
          <section class="section">
            <h2>Sort direction</h2>
            <mat-radio-group class="radioGroup" aria-label="Sort Direction" [(ngModel)]="sortDirection"
              (change)="applyFilters()">
              <mat-radio-button class="radioButton" value="asc">Ascending</mat-radio-button>
              <mat-radio-button class="radioButton" value="des">Descending</mat-radio-button>
            </mat-radio-group>
          </section>

          <mat-divider></mat-divider>
          <section class="section">
            <h2>Display Options</h2>
            <mat-checkbox class="example-margin" [(ngModel)]="displaySettings.displayUserInfo">User Info</mat-checkbox>
            <mat-checkbox class="example-margin" [(ngModel)]="displaySettings.displayTrophyCounts"
              [disabled]="!displaySettings.displayUserInfo">
              Trophy Counts
            </mat-checkbox>
            <mat-checkbox class="example-margin" [(ngModel)]="displaySettings.displayGameTitle">Game Title
            </mat-checkbox>
            <mat-checkbox class="example-margin" [(ngModel)]="displaySettings.displayTrophyTitle">Trophy Title
            </mat-checkbox>
            <mat-checkbox class="example-margin" [(ngModel)]="displaySettings.displayRarity">Rarity</mat-checkbox>
          </section>

          <mat-divider></mat-divider>
          <section class="section dateSection">
            <h2>Date Filter</h2>
            <mat-form-field appearance="fill">
              <mat-label>Enter a date range</mat-label>
              <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
                <input matStartDate formControlName="start" placeholder="Start date" (dateChange)="applyFilters()">
                <input matEndDate formControlName="end" placeholder="End date" (dateChange)="applyFilters()">
              </mat-date-range-input>
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
          </section>

          <mat-divider></mat-divider>
          <section class="section dateSection">
            <h2 class="gameFilterTitle">Game Title Filter</h2>
            <mat-form-field>
              <input matInput #gameFilterInput placeholder="Enter a game title" autocomplete="off"
                [(ngModel)]="gameFilterQuery" (keyup)="applyFilters()">
            </mat-form-field>
          </section>

          <mat-divider></mat-divider>
          <button class="saveButton" mat-raised-button color="primary" (click)="trophyCase.save()">Save as PNG</button>
          <mat-spinner *ngIf="isSaveLoading" class="save-spinner" [diameter]="30"></mat-spinner>
        </ng-container>
      </div>
    </mat-card-content>
  </mat-card>

  <app-trophy-case #trophyCase *ngIf="user" [platinums]="currentPlats" [user]="user" [displaySettings]="displaySettings"
    (uponIsSaveLoading)="uponIsSaveLoading($event)">
  </app-trophy-case>
</div>